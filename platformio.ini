; ============================================================================
; GridShield PlatformIO Configuration
; ============================================================================

[platformio]
; Set default environment ke Arduino Mega (bisa diubah ke native kalau mau tes di PC)
default_envs = megaatmega2560
include_dir = include
src_dir = src

; Konfigurasi dasar untuk semua environment
[env]
build_flags =
    -std=gnu++17
    -I include/common
    -I include/platform
build_unflags =
    -std=gnu++11

; ============================================================================
; ENVIRONMENT: Arduino Mega 2560 (Production & Wokwi Simulation)
; ============================================================================
[env:megaatmega2560]
platform = atmelavr
board = megaatmega2560
framework = arduino
monitor_speed = 115200

build_flags =
    ${env.build_flags}
    -I include/arduino
    -D GS_PLATFORM_ARDUINO=1

; Rara, perhatikan ini! Ini kuncinya biar kode native nggak ikut di-compile
src_filter =
    +<common/>
    +<arduino/>
    +<platform/>
    -<native/>

; Install library otomatis
lib_deps =
    rweather/Crypto@^0.4.0
    libs/micro-ecc/

; ============================================================================
; ENVIRONMENT: Native (PC Testing)
; ============================================================================
[env:native]
platform = native

build_flags =
    ${env.build_flags}
    -I include/native
    -D GS_PLATFORM_NATIVE=1
    ; Jangan lupa sesuaikan path OpenSSL kalau kamu jalanin native di Windows/Mac
    ; -L"C:/Program Files/OpenSSL-Win64/lib"
    ; -lcrypto
    ; -lssl

src_filter =
    +<common/>
    +<native/>
    +<platform/>
    -<arduino/>