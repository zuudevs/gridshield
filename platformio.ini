; ============================================================================
; GridShield PlatformIO Configuration
; ============================================================================

[platformio]
default_envs = megaatmega2560
include_dir = include
src_dir = src

; ============================================================================
; ENVIRONMENT: Arduino Mega 2560 (Production & Wokwi Simulation)
; ============================================================================
[env:megaatmega2560]
platform = atmelavr
board = megaatmega2560
framework = arduino
monitor_speed = 115200

build_flags =
    -std=gnu++17
    -I include/common
    -I include/platform
    -I include/arduino
    -D GS_PLATFORM_ARDUINO=1
    ; Disable aligned allocation untuk AVR
    -fno-aligned-new

build_unflags =
    -std=gnu++11

; CRITICAL: Filter source files - Arduino only
build_src_filter =
    +<common/>
    +<arduino/>
    +<platform/>
    -<native/>
    -<examples/>

; Install library otomatis
lib_deps =
    rweather/Crypto@^0.4.0
	libs/micro-ecc

; ============================================================================
; ENVIRONMENT: Native (PC Testing) - Optional
; ============================================================================
[env:native]
platform = native

build_flags =
    -std=c++17
    -I include/common
    -I include/platform
    -I include/native
    -D GS_PLATFORM_NATIVE=1

build_src_filter =
    +<common/>
    +<native/>
    +<platform/>
    -<arduino/>
    -<examples/>